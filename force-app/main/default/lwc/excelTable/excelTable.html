<template>
  <div class="excel-table-container">
    <table style="width:100%" oncontextmenu={handleContextMenu} onkeypress={handleKeyPress} oncopy={handleCopy}
      onpaste={handlePaste}>

      <!-- Columns -->
      <tr>
        <th if:true={showRowNumberColumn}></th>
        <template for:each={columns} for:item="column">
          <th key={column.fieldName} class="column">
            <div class="resize-column" ondblclick={handleColumnSortClick} data-field={column.fieldName}>
              {column.label}
              <lightning-icon class="sort-icon" icon-name="utility:arrowdown" data-arrow-field={column.fieldName} alternative-text="Connected" size="x-small"></lightning-icon>
            </div>
          </th>
        </template>
      </tr>

      <template if:true={hasRecords}>
        <!-- Rows  -->
        <template for:each={records} for:item="record" for:index="rowIndex">
          <tr key={record.recordId} data-record-id={record.recordId}>
            <!-- Row Number -->
            <td class="row-number" if:true={showRowNumberColumn} key={record}>
              {rowIndex}
            </td>
            <!-- Fieldset row -->
            <template for:each={record.fields} for:item="field" for:index="columnIndex">
              <td key={field.key} data-field={field.fieldName} data-row={rowIndex} data-column={columnIndex}
                ondblclick={handleDoubleClick} onmouseover={handleOver} onmouseup={handleUp} onmousedown={handleDown}>

                <div class="cell" contenteditable role="textbox" ondblclick={handleDoubleClick}
                  onfocusout={handleFocusOut} oninput={handleCellValueChange} onresize={handleResize}>
                  {field.value}
                </div>

                <!-- <div class="cell-action" onmousedown={handleCellActionKeyDown}></div> -->
              </td>
            </template>
          </tr>
        </template>
      </template>

    </table>


    <!-- No Records -->
    <template if:false={hasRecords}>
      <div class="no-records-found">
        No records found.
      </div>
    </template>
  </div>

  <!-- Context Menu -->
  <div id="context-menu" class="menu-context">
    <template for:each={contextMenuItems} for:item="contextMenuItem">
      <lightning-button key={contextMenuItem.action} variant="base" label={contextMenuItem.label}
        icon-name={contextMenuItem.icon} data-action={contextMenuItem.action} onclick={contextMenuItem.actionHandler}>
      </lightning-button>
    </template>
  </div>

  <div class="copy-border"></div>
</template>